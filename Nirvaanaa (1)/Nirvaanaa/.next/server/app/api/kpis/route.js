(()=>{var e={};e.id=323,e.ids=[323],e.modules={11185:e=>{"use strict";e.exports=require("mongoose")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},39512:e=>{"use strict";e.exports=require("timers")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},39697:()=>{},62302:()=>{},30107:()=>{},47524:()=>{},33745:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>x,originalPathname:()=>A,patchFetch:()=>I,requestAsyncStorage:()=>q,routeModule:()=>b,serverHooks:()=>v,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>N});var i={};r.r(i),r.d(i,{DELETE:()=>S,GET:()=>y,POST:()=>f});var n=r(95419),a=r(69108),s=r(99678),o=r(88578),u=r(11185),d=r.n(u);let c=new(d()).Schema({label:{type:String,required:!0,trim:!0},value:{type:String,required:!0,trim:!0},createdBy:{type:d().Schema.Types.ObjectId,ref:"User"}},{timestamps:!0});c.index({createdAt:-1});let p=d().models.Kpi||d().model("Kpi",c);var l=r(50798),m=r(87786),g=r(65537),h=r(4595);async function y(e){await (0,o.Z)();try{let e=[];try{let t=await p.find();Array.isArray(t)?e=t:"function"==typeof t.sort&&(e=await t.sort({createdAt:-1}).lean())}catch(t){e=[]}let t=await l.Z.aggregate([{$match:{paymentStatus:"paid"}},{$group:{_id:null,total:{$sum:"$total"},orders:{$sum:1}}}]),r=t[0]?.total||0,i=t[0]?.orders||0,n=await m.Z.countDocuments({}),a=await g.Z.countDocuments({published:!0}),s=[{label:"Total Revenue",value:`â‚¹${Number(r).toLocaleString("en-IN")}`},{label:"Orders",value:String(i)},{label:"Customers",value:String(n)},{label:"Active Products",value:String(a)}];return new Response(JSON.stringify({kpis:e,computed:s}),{status:200})}catch(t){console.error("GET /api/kpis error",t);let e=[];try{let t=await p.find();Array.isArray(t)?e=t:"function"==typeof t.sort&&(e=await t.sort({createdAt:-1}).lean())}catch(t){e=[]}return new Response(JSON.stringify({kpis:e,computed:[]}),{status:200})}}async function f(e){await (0,o.Z)();try{let t=await e.json(),r=new p({label:t.label,value:t.value,createdBy:t.createdBy});return await r.save(),(0,h.emitToAdmin)("kpi-changed",{action:"created",kpi:r.toObject()}),new Response(JSON.stringify({kpi:r}),{status:201})}catch(e){return new Response(JSON.stringify({error:e.message}),{status:500})}}async function S(e){await (0,o.Z)();try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return new Response(JSON.stringify({error:"id required"}),{status:400});return await p.findByIdAndDelete(r),(0,h.emitToAdmin)("kpi-changed",{action:"deleted",kpiId:r}),new Response(JSON.stringify({success:!0}),{status:200})}catch(e){return new Response(JSON.stringify({error:e.message}),{status:500})}}let b=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/kpis/route",pathname:"/api/kpis",filename:"route",bundlePath:"app/api/kpis/route"},resolvedPagePath:"C:\\Users\\Ananya\\Downloads\\Nirvaanaa_current\\Nirvaanaa (1)\\Nirvaanaa\\app\\api\\kpis\\route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:q,staticGenerationAsyncStorage:w,serverHooks:v,headerHooks:x,staticGenerationBailout:N}=b,A="/api/kpis/route";function I(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:w})}},88578:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var i=r(11185),n=r.n(i);let a=process.env.MONGODB_URI;if(!a)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let s=global.mongoose;s||(s=global.mongoose={conn:null,promise:null});let o=async function(){if(s.conn)return s.conn;s.promise||(s.promise=n().connect(a,{bufferCommands:!1}).then(e=>e));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}},4595:(e,t,r)=>{let i;let{Server:n}=r(26371);e.exports={initSocket:e=>((i=new n(e,{cors:{origin:process.env.NEXTAUTH_URL||"http://localhost:3000",methods:["GET","POST"]}})).on("connection",e=>{console.log("Client connected:",e.id),e.on("join-admin",()=>{e.join("admin"),console.log("Admin joined:",e.id)}),e.on("join-user",t=>{e.join(`user-${t}`),console.log("User joined:",t)}),e.on("cart-updated",t=>{e.broadcast.to(`user-${t.userId}`).emit("cart-changed",t)}),e.on("wishlist-updated",t=>{e.broadcast.to(`user-${t.userId}`).emit("wishlist-changed",t)}),e.on("product-updated",t=>{e.broadcast.to("admin").emit("product-changed",t)}),e.on("kpi-updated",t=>{e.broadcast.to("admin").emit("kpi-changed",t)}),e.on("disconnect",()=>{console.log("Client disconnected:",e.id)})}),i),getIO:()=>{if(!i)throw Error("Socket.io not initialized!");return i},emitToUser:(e,t,r)=>{i&&i.to(`user-${e}`).emit(t,r)},emitToAdmin:(e,t)=>{i&&i.to("admin").emit(e,t)},emitToAll:(e,t)=>{i&&i.emit(e,t)}}},50798:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var i=r(11185),n=r.n(i);let a=new(n()).Schema({orderNumber:{type:String,unique:!0},userId:{type:n().Schema.Types.ObjectId,ref:"User",required:!0},items:[{productId:{type:n().Schema.Types.ObjectId,ref:"Product",required:!0},name:{type:String,required:!0},image:{type:String,required:!0},price:{type:Number,required:!0,min:0},originalPrice:{type:Number,min:0,default:0},discount:{type:Number,min:0,default:0},quantity:{type:Number,required:!0,min:1},sku:String,colorVariant:{name:String,hex:String,images:[String]}}],subtotal:{type:Number,required:!0,min:0},tax:{type:Number,required:!0,min:0,default:0},shipping:{type:Number,required:!0,min:0,default:0},discount:{type:Number,required:!0,min:0,default:0},total:{type:Number,required:!0,min:0},currency:{type:String,required:!0,default:"INR"},status:{type:String,enum:["pending","processing","shipped","delivered","cancelled","refunded"],default:"pending"},paymentStatus:{type:String,enum:["pending","paid","failed","refunded"],default:"pending"},paymentMethod:{type:String,enum:["razorpay","cod"],required:!0},razorpayOrderId:{type:String,sparse:!0},razorpayPaymentId:{type:String,sparse:!0},shippingAddress:{name:{type:String,required:!0},phone:{type:String,required:!0},street:{type:String,required:!0},city:{type:String,required:!0},state:{type:String,required:!0},zipCode:{type:String,required:!0},country:{type:String,required:!0,default:"India"}},billingAddress:{name:{type:String,required:!0},phone:{type:String,required:!0},street:{type:String,required:!0},city:{type:String,required:!0},state:{type:String,required:!0},zipCode:{type:String,required:!0},country:{type:String,required:!0,default:"India"}},shippingMethod:{name:{type:String,required:!0,default:"Standard Shipping"},estimatedDays:{type:Number,required:!0,default:5},trackingNumber:String,trackingUrl:String},notes:{customer:String,admin:String},timeline:[{status:{type:String,required:!0},message:{type:String,required:!0},timestamp:{type:Date,default:Date.now},updatedBy:{type:n().Schema.Types.ObjectId,ref:"User"}}],emailSent:{confirmation:{type:Boolean,default:!1},shipped:{type:Boolean,default:!1},delivered:{type:Boolean,default:!1}},smsSent:{confirmation:{type:Boolean,default:!1},shipped:{type:Boolean,default:!1},delivered:{type:Boolean,default:!1}},refundAmount:{type:Number,min:0},refundReason:String,cancelledAt:Date,cancelledBy:{type:n().Schema.Types.ObjectId,ref:"User"},deliveredAt:Date},{timestamps:!0});a.index({orderNumber:1}),a.index({userId:1}),a.index({status:1}),a.index({paymentStatus:1}),a.index({createdAt:-1}),a.index({razorpayOrderId:1}),a.index({razorpayPaymentId:1}),a.index({"shippingAddress.phone":1}),a.virtual("orderSummary").get(function(){return{orderNumber:this.orderNumber,total:this.total,status:this.status,itemCount:this.items.length,createdAt:this.createdAt}}),a.virtual("customerInfo").get(function(){return{name:this.shippingAddress.name,phone:this.shippingAddress.phone,email:this.userId?.email}}),a.methods.addTimelineEntry=function(e,t,r=null){return this.timeline.push({status:e,message:t,timestamp:new Date,updatedBy:r}),this.save()},a.methods.updateStatus=function(e,t,r=null){return this.status=e,this.addTimelineEntry(e,t,r),"delivered"===e&&(this.deliveredAt=new Date),"cancelled"===e&&(this.cancelledAt=new Date,this.cancelledBy=r),this.save()},a.methods.calculateTotals=function(){return this.subtotal=this.items.reduce((e,t)=>e+t.price*t.quantity,0),this.total=this.subtotal+this.tax+this.shipping-this.discount,this.save()},a.statics.generateOrderNumber=async function(){let e=new Date,t=e.getFullYear().toString().slice(-2),r=(e.getMonth()+1).toString().padStart(2,"0"),i=e.getDate().toString().padStart(2,"0"),n=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1),s=(await this.countDocuments({createdAt:{$gte:n,$lt:a}})+1).toString().padStart(3,"0");return`NV${t}${r}${i}${s}`},a.statics.findByUser=function(e){return this.find({userId:e}).sort({createdAt:-1})},a.statics.findPending=function(){return this.find({status:"pending"}).sort({createdAt:-1})},a.statics.findByStatus=function(e){return this.find({status:e}).sort({createdAt:-1})},a.pre("save",async function(e){this.isNew&&!this.orderNumber&&(this.orderNumber=await this.constructor.generateOrderNumber()),e()}),a.set("toJSON",{virtuals:!0,transform:function(e,t){return delete t.__v,t}});let s=n().models.Order||n().model("Order",a)},65537:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var i=r(11185),n=r.n(i);let a=new(n()).Schema({title:{type:String,required:[!0,"Product title is required"],trim:!0,maxlength:[100,"Title cannot be more than 100 characters"]},slug:{type:String,required:[!0,"Product slug is required"],unique:!0,lowercase:!0,trim:!0,match:[/^[a-z0-9-]+$/,"Slug can only contain lowercase letters, numbers, and hyphens"]},description:{type:String,required:[!0,"Product description is required"],maxlength:[2e3,"Description cannot be more than 2000 characters"]},shortDescription:{type:String,maxlength:[200,"Short description cannot be more than 200 characters"]},images:[{url:{type:String,required:!0},alt:{type:String,required:!0},publicId:{type:String,required:!0}}],price:{type:Number,required:[!0,"Product price is required"],min:[0,"Price cannot be negative"]},discount:{type:Number,min:[0,"Discount cannot be negative"],max:[100,"Discount cannot be more than 100%"],default:0},comparePrice:{type:Number,min:[0,"Compare price cannot be negative"]},stock:{type:Number,required:[!0,"Stock quantity is required"],min:[0,"Stock cannot be negative"],default:10},sku:{type:String,unique:!0,sparse:!0,trim:!0},tags:[{type:String,trim:!0,lowercase:!0}],category:{type:String,required:[!0,"Product category is required"],enum:["bangle-box","clutch","gift-hampers","goggle-cover","kitty-bag","long-tote-bag","picnic-bag","potli-purse","sling-bags","velvet-clutch-with-flaps"]},subcategory:{type:String,trim:!0},materials:[{type:String,trim:!0}],dimensions:{length:Number,width:Number,height:Number,unit:{type:String,enum:["cm","inches"],default:"cm"}},weight:{value:Number,unit:{type:String,enum:["g","kg","lbs"],default:"g"}},colors:[{name:String,hex:String}],colorVariants:[{name:{type:String,required:!0,trim:!0},hex:{type:String,required:!0,match:[/^#[0-9A-Fa-f]{6}$/,"Hex color must be in format #RRGGBB"]},images:[{type:String,trim:!0}]}],published:{type:Boolean,default:!0},featured:{type:Boolean,default:!1},seo:{metaTitle:{type:String,maxlength:[60,"Meta title cannot be more than 60 characters"]},metaDescription:{type:String,maxlength:[160,"Meta description cannot be more than 160 characters"]},keywords:[String]},ratings:{average:{type:Number,default:0,min:0,max:5},count:{type:Number,default:0,min:0}},salesCount:{type:Number,default:0,min:0},isHandmade:{type:Boolean,default:!0},madeIn:{type:String,default:"India"},careInstructions:{type:String,maxlength:[500,"Care instructions cannot be more than 500 characters"]}},{timestamps:!0});a.index({slug:1}),a.index({category:1}),a.index({tags:1}),a.index({published:1}),a.index({featured:1}),a.index({"ratings.average":-1}),a.index({salesCount:-1}),a.index({createdAt:-1}),a.set("toJSON",{virtuals:!0,transform:function(e,t){return delete t.__v,t}}),a.virtual("discountPercentage").get(function(){return this.comparePrice&&this.comparePrice>this.price?Math.round((this.comparePrice-this.price)/this.comparePrice*100):0}),a.virtual("inStock").get(function(){return this.stock>0}),a.virtual("mainImage").get(function(){return this.images.length>0?this.images[0]:null}),a.methods.updateStock=function(e){return this.stock=Math.max(0,this.stock-e),this.save()},a.methods.incrementSales=function(e=1){return this.salesCount+=e,this.save()},a.statics.findPublished=function(){return this.find({published:!0})},a.statics.findFeatured=function(){return this.find({published:!0,featured:!0})},a.statics.findByCategory=function(e){return this.find({published:!0,category:e})},a.statics.search=function(e){return this.find({published:!0,$or:[{title:{$regex:e,$options:"i"}},{description:{$regex:e,$options:"i"}},{tags:{$in:[RegExp(e,"i")]}}]})},a.pre("save",function(e){!this.slug&&this.title&&(this.slug=this.title.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-")),e()}),a.set("toJSON",{virtuals:!0,transform:function(e,t){return delete t.__v,t}});let s=n().models.Product||n().model("Product",a)},87786:(e,t,r)=>{"use strict";r.d(t,{Z:()=>u});var i=r(11185),n=r.n(i),a=r(6521),s=r.n(a);let o=new(n()).Schema({name:{type:String,required:[!0,"Name is required"],trim:!0,maxlength:[50,"Name cannot be more than 50 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,lowercase:!0,trim:!0,match:[/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,"Please enter a valid email"]},passwordHash:{type:String,required:function(){return!this.googleId&&!this.facebookId}},role:{type:String,enum:["user","admin"],default:"user"},googleId:{type:String,sparse:!0},facebookId:{type:String,sparse:!0},image:{type:String},profileImage:{type:String},phone:{type:String,match:[/^\+?[\d\s-()]+$/,"Please enter a valid phone number"]},addresses:[{type:{type:String,enum:["shipping","billing"],required:!0},street:{type:String,required:!0},city:{type:String,required:!0},state:{type:String,required:!0},zipCode:{type:String,required:!0},country:{type:String,required:!0,default:"India"},isDefault:{type:Boolean,default:!1}}],shippingAddress:{name:String,street:String,city:String,state:String,zipCode:String,country:{type:String,default:"India"},phone:String},emailVerified:{type:Boolean,default:!1},isActive:{type:Boolean,default:!0},cart:[{productId:{type:n().Schema.Types.ObjectId,ref:"Product"},name:String,image:String,price:Number,quantity:{type:Number,default:1},slug:String}],wishlist:[{productId:{type:n().Schema.Types.ObjectId,ref:"Product"},name:String,image:String,price:Number,slug:String,addedAt:{type:Date,default:Date.now}}],lastLogin:{type:Date},resetPasswordToken:{type:String},resetPasswordExpires:{type:Date}},{timestamps:!0});o.index({email:1}),o.index({googleId:1}),o.index({facebookId:1}),o.index({role:1}),o.virtual("password").set(function(e){e&&(this.passwordHash=s().hashSync(e,12))}).get(function(){return this.passwordHash}),o.methods.checkPassword=function(e){return s().compareSync(e,this.passwordHash)},o.methods.getPublicProfile=function(){let e=this.toObject();return delete e.passwordHash,delete e.__v,e},o.statics.findByEmail=function(e){return this.findOne({email:e.toLowerCase()})},o.statics.findAdmins=function(){return this.find({role:"admin"})},o.pre("save",async function(e){if(this.isModified("email")&&await this.constructor.findOne({email:this.email,_id:{$ne:this._id}}))throw Error("Email already exists");e()}),o.set("toJSON",{virtuals:!0,transform:function(e,t){return delete t.passwordHash,delete t.__v,t}});let u=n().models.User||n().model("User",o)},95419:(e,t,r)=>{"use strict";e.exports=r(30517)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[1638,6521,4136,6371],()=>r(33745));module.exports=i})();