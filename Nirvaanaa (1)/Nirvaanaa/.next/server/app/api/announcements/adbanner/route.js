"use strict";(()=>{var e={};e.id=6273,e.ids=[6273,2242],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},82112:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>v,originalPathname:()=>x,patchFetch:()=>S,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>w,staticGenerationAsyncStorage:()=>y,staticGenerationBailout:()=>b});var a={};r.r(a),r.d(a,{GET:()=>p,POST:()=>f,PUT:()=>m});var n=r(95419),i=r(69108),o=r(99678),s=r(59269),d=r(88578),l=r(78070),u=r(81355),c=r(82242);async function p(){try{await (0,d.Z)();let e=await s.Z.findAdBanner();return l.Z.json({banner:e},{status:200})}catch(e){return console.error("GET adbanner error:",e),l.Z.json({error:"Failed to fetch banner"},{status:500})}}async function m(e){try{await (0,d.Z)();let t=await e.json(),{id:r}=t||{};if(!r)return l.Z.json({error:"Missing id"},{status:400});let a={};"boolean"==typeof t.isAdBannerActive&&(a.isAdBannerActive=t.isAdBannerActive),"string"==typeof t.text&&(a.text=t.text),"string"==typeof t.backgroundColor&&(a.backgroundColor=t.backgroundColor),"string"==typeof t.textColor&&(a.textColor=t.textColor),"string"==typeof t.image&&(a.image=t.image),"number"==typeof t.priority&&(a.priority=t.priority),"object"==typeof t.link&&t.link&&(a.link=t.link),t.startDate&&(a.startDate=new Date(t.startDate)),t.endDate&&(a.endDate=new Date(t.endDate));let n=await s.Z.findByIdAndUpdate(r,a,{new:!0});if(!n)return l.Z.json({error:"Banner not found"},{status:404});return l.Z.json({banner:n},{status:200})}catch(e){return console.error("PUT adbanner error:",e),l.Z.json({error:"Failed to update banner"},{status:500})}}async function f(e){try{await (0,d.Z)();let t=await (0,u.getServerSession)(c.authOptions);if(!t?.user)return l.Z.json({error:"Unauthorized"},{status:401});let r=await e.json(),{text:a,backgroundColor:n,textColor:i,priority:o,startDate:p,endDate:m}=r||{};if(!a)return l.Z.json({error:"Text is required"},{status:400});let f=await s.Z.create({type:"adbanner",text:a,backgroundColor:"string"==typeof n?n:void 0,textColor:"string"==typeof i?i:void 0,priority:"number"==typeof o?o:void 0,startDate:p?new Date(p):void 0,endDate:m?new Date(m):void 0,createdBy:t.user.id,isAdBannerActive:"boolean"==typeof r.isAdBannerActive&&r.isAdBannerActive});return l.Z.json({banner:f},{status:201})}catch(e){return console.error("POST adbanner error:",e),l.Z.json({error:"Failed to create banner"},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/announcements/adbanner/route",pathname:"/api/announcements/adbanner",filename:"route",bundlePath:"app/api/announcements/adbanner/route"},resolvedPagePath:"C:\\Users\\Ananya\\Downloads\\Nirvaanaa_current\\Nirvaanaa (1)\\Nirvaanaa\\app\\api\\announcements\\adbanner\\route.js",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:y,serverHooks:w,headerHooks:v,staticGenerationBailout:b}=g,x="/api/announcements/adbanner/route";function S(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:y})}},82242:(e,t,r)=>{r.d(t,{authOptions:()=>u});var a=r(86485),n=r(10375),i=r(98904),o=r(88578),s=r(87786),d=r(6521),l=r.n(d);let u={providers:[(0,a.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Email and password are required");await (0,o.Z)();let t=await s.Z.findOne({email:e.email});if(!t)throw Error("Invalid email or password");if(!t.passwordHash)throw Error("Please sign in with your social account");if(!await l().compare(e.password,t.passwordHash))throw Error("Invalid email or password");if(!t.isActive)throw Error("Account is deactivated");return{id:t._id.toString(),name:t.name,email:t.email,role:t.role,image:t.image}}}),(0,n.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}),(0,i.Z)({clientId:process.env.FACEBOOK_CLIENT_ID,clientSecret:process.env.FACEBOOK_CLIENT_SECRET})],callbacks:{async signIn({user:e,account:t,profile:r}){if(t?.provider==="google"||t?.provider==="facebook"){await (0,o.Z)();let a=await s.Z.findOne({$or:[{email:e.email},{googleId:"google"===t.provider?r.sub:null},{facebookId:"facebook"===t.provider?r.id:null}]});if(a)return"google"!==t.provider||a.googleId?"facebook"!==t.provider||a.facebookId||(a.facebookId=r.id,a.image=e.image,await a.save()):(a.googleId=r.sub,a.image=e.image,await a.save()),a.isActive;{let a=new s.Z({name:e.name,email:e.email,image:e.image,googleId:"google"===t.provider?r.sub:null,facebookId:"facebook"===t.provider?r.id:null,emailVerified:!0});return await a.save(),!0}}try{await (0,o.Z)();let t=await s.Z.findOne({email:e.email});t&&(t.lastLogin=new Date,await t.save())}catch(e){}return!0},async jwt({token:e,user:t,account:r}){if(t&&(e.role=t.role,e.id=t.id,"admin"===t.role&&(e.maxAge=7200)),r?.provider==="google"||r?.provider==="facebook"){await (0,o.Z)();let t=await s.Z.findOne({email:e.email});t&&(e.role=t.role,e.id=t._id.toString(),"admin"===t.role&&(e.maxAge=7200))}if("admin"===e.role&&e.maxAge){let t=Math.floor(Date.now()/1e3),r=e.iat||t;if(t-r>e.maxAge)return null}return e},async session({session:e,token:t}){if(t&&(e.user.id=t.id,e.user.role=t.role,"admin"===t.role)){await (0,o.Z)();let r=await s.Z.findById(t.id);r&&"admin"===r.role&&r.isActive||(e.user.role="user")}return e}},pages:{signIn:"/auth/signin",error:"/auth/error"},session:{strategy:"jwt",maxAge:2592e3},cookies:{sessionToken:{name:"next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}},callbackUrl:{name:"next-auth.callback-url",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}},csrfToken:{name:"next-auth.csrf-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}},secret:process.env.NEXTAUTH_SECRET,debug:!1}},88578:(e,t,r)=>{r.d(t,{Z:()=>s});var a=r(11185),n=r.n(a);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let o=global.mongoose;o||(o=global.mongoose={conn:null,promise:null});let s=async function(){if(o.conn)return o.conn;o.promise||(o.promise=n().connect(i,{bufferCommands:!1}).then(e=>e));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}},59269:(e,t,r)=>{r.d(t,{Z:()=>o});var a=r(11185),n=r.n(a);let i=new(n()).Schema({text:{type:String,maxlength:[200,"Text cannot be more than 200 characters"],trim:!0},type:{type:String,enum:["announcement","adbanner"],default:"announcement",required:!0},isAnnouncementActive:{type:Boolean,default:!1},isAdBannerActive:{type:Boolean,default:!1},backgroundColor:{type:String,default:"#f59e0b",match:[/^#[0-9A-F]{6}$/i,"Please enter a valid hex color"]},textColor:{type:String,default:"#ffffff",match:[/^#[0-9A-F]{6}$/i,"Please enter a valid hex color"]},link:{url:String,text:String},image:{type:String,required:!1},priority:{type:Number,default:1,min:1,max:10},startDate:{type:Date,default:Date.now},endDate:{type:Date},createdBy:{type:n().Schema.Types.ObjectId,ref:"User",required:!0}},{timestamps:!0});i.index({isAnnouncementActive:1}),i.index({isAdBannerActive:1}),i.index({priority:-1}),i.index({startDate:1,endDate:1}),i.virtual("isAnnouncementCurrentlyActive").get(function(){if(!this.isAnnouncementActive)return!1;let e=new Date;return(!this.startDate||!(e<this.startDate))&&(!this.endDate||!(e>this.endDate))}),i.virtual("isAdBannerCurrentlyActive").get(function(){if(!this.isAdBannerActive)return!1;let e=new Date;return(!this.startDate||!(e<this.startDate))&&(!this.endDate||!(e>this.endDate))}),i.statics.findAnnouncementBanner=function(){let e=new Date;return this.findOne({type:"announcement",isAnnouncementActive:!0,$and:[{$or:[{startDate:{$lte:e}},{startDate:{$exists:!1}}]},{$or:[{endDate:{$gte:e}},{endDate:{$exists:!1}}]}]}).sort({priority:-1,createdAt:-1})},i.statics.findAdBanner=function(){let e=new Date;return this.findOne({type:"adbanner",isAdBannerActive:!0,$and:[{$or:[{startDate:{$lte:e}},{startDate:{$exists:!1}}]},{$or:[{endDate:{$gte:e}},{endDate:{$exists:!1}}]}]}).sort({priority:-1,createdAt:-1})};let o=n().models.Announcement||n().model("Announcement",i)},87786:(e,t,r)=>{r.d(t,{Z:()=>d});var a=r(11185),n=r.n(a),i=r(6521),o=r.n(i);let s=new(n()).Schema({name:{type:String,required:[!0,"Name is required"],trim:!0,maxlength:[50,"Name cannot be more than 50 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,lowercase:!0,trim:!0,match:[/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,"Please enter a valid email"]},passwordHash:{type:String,required:function(){return!this.googleId&&!this.facebookId}},role:{type:String,enum:["user","admin"],default:"user"},googleId:{type:String,sparse:!0},facebookId:{type:String,sparse:!0},image:{type:String},profileImage:{type:String},phone:{type:String,match:[/^\+?[\d\s-()]+$/,"Please enter a valid phone number"]},addresses:[{type:{type:String,enum:["shipping","billing"],required:!0},street:{type:String,required:!0},city:{type:String,required:!0},state:{type:String,required:!0},zipCode:{type:String,required:!0},country:{type:String,required:!0,default:"India"},isDefault:{type:Boolean,default:!1}}],shippingAddress:{name:String,street:String,city:String,state:String,zipCode:String,country:{type:String,default:"India"},phone:String},emailVerified:{type:Boolean,default:!1},isActive:{type:Boolean,default:!0},cart:[{productId:{type:n().Schema.Types.ObjectId,ref:"Product"},name:String,image:String,price:Number,quantity:{type:Number,default:1},slug:String}],wishlist:[{productId:{type:n().Schema.Types.ObjectId,ref:"Product"},name:String,image:String,price:Number,slug:String,addedAt:{type:Date,default:Date.now}}],lastLogin:{type:Date},resetPasswordToken:{type:String},resetPasswordExpires:{type:Date}},{timestamps:!0});s.index({email:1}),s.index({googleId:1}),s.index({facebookId:1}),s.index({role:1}),s.virtual("password").set(function(e){e&&(this.passwordHash=o().hashSync(e,12))}).get(function(){return this.passwordHash}),s.methods.checkPassword=function(e){return o().compareSync(e,this.passwordHash)},s.methods.getPublicProfile=function(){let e=this.toObject();return delete e.passwordHash,delete e.__v,e},s.statics.findByEmail=function(e){return this.findOne({email:e.toLowerCase()})},s.statics.findAdmins=function(){return this.find({role:"admin"})},s.pre("save",async function(e){if(this.isModified("email")&&await this.constructor.findOne({email:this.email,_id:{$ne:this._id}}))throw Error("Email already exists");e()}),s.set("toJSON",{virtuals:!0,transform:function(e,t){return delete t.passwordHash,delete t.__v,t}});let d=n().models.User||n().model("User",s)},83191:(e,t)=>{/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */t.parse=function(e,t){if("string"!=typeof e)throw TypeError("argument str must be a string");var r={},n=e.length;if(n<2)return r;var i=t&&t.decode||u,o=0,s=0,c=0;do{if(-1===(s=e.indexOf("=",o)))break;if(-1===(c=e.indexOf(";",o)))c=n;else if(s>c){o=e.lastIndexOf(";",s-1)+1;continue}var p=d(e,o,s),m=l(e,s,p),f=e.slice(p,m);if(!a.call(r,f)){var g=d(e,s+1,c),h=l(e,c,g);34===e.charCodeAt(g)&&34===e.charCodeAt(h-1)&&(g++,h--);var y=e.slice(g,h);r[f]=function(e,t){try{return t(e)}catch(t){return e}}(y,i)}o=c+1}while(o<n);return r},t.serialize=function(e,t,a){var d=a&&a.encode||encodeURIComponent;if("function"!=typeof d)throw TypeError("option encode is invalid");if(!n.test(e))throw TypeError("argument name is invalid");var l=d(t);if(!i.test(l))throw TypeError("argument val is invalid");var u=e+"="+l;if(!a)return u;if(null!=a.maxAge){var c=Math.floor(a.maxAge);if(!isFinite(c))throw TypeError("option maxAge is invalid");u+="; Max-Age="+c}if(a.domain){if(!o.test(a.domain))throw TypeError("option domain is invalid");u+="; Domain="+a.domain}if(a.path){if(!s.test(a.path))throw TypeError("option path is invalid");u+="; Path="+a.path}if(a.expires){var p=a.expires;if("[object Date]"!==r.call(p)||isNaN(p.valueOf()))throw TypeError("option expires is invalid");u+="; Expires="+p.toUTCString()}if(a.httpOnly&&(u+="; HttpOnly"),a.secure&&(u+="; Secure"),a.partitioned&&(u+="; Partitioned"),a.priority)switch("string"==typeof a.priority?a.priority.toLowerCase():a.priority){case"low":u+="; Priority=Low";break;case"medium":u+="; Priority=Medium";break;case"high":u+="; Priority=High";break;default:throw TypeError("option priority is invalid")}if(a.sameSite)switch("string"==typeof a.sameSite?a.sameSite.toLowerCase():a.sameSite){case!0:case"strict":u+="; SameSite=Strict";break;case"lax":u+="; SameSite=Lax";break;case"none":u+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return u};var r=Object.prototype.toString,a=Object.prototype.hasOwnProperty,n=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/,i=/^("?)[\u0021\u0023-\u002B\u002D-\u003A\u003C-\u005B\u005D-\u007E]*\1$/,o=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,s=/^[\u0020-\u003A\u003D-\u007E]*$/;function d(e,t,r){do{var a=e.charCodeAt(t);if(32!==a&&9!==a)return t}while(++t<r);return r}function l(e,t,r){for(;t>r;){var a=e.charCodeAt(--t);if(32!==a&&9!==a)return t+1}return r}function u(e){return -1!==e.indexOf("%")?decodeURIComponent(e):e}},86485:(e,t)=>{t.Z=function(e){return{id:"credentials",name:"Credentials",type:"credentials",credentials:{},authorize:()=>null,options:e}}},98904:(e,t)=>{t.Z=function(e){return{id:"facebook",name:"Facebook",type:"oauth",authorization:"https://www.facebook.com/v11.0/dialog/oauth?scope=email",token:"https://graph.facebook.com/oauth/access_token",userinfo:{url:"https://graph.facebook.com/me",params:{fields:"id,name,email,picture"},async request({tokens:e,client:t,provider:r}){var a;return await t.userinfo(e.access_token,{params:null===(a=r.userinfo)||void 0===a?void 0:a.params})}},profile:e=>({id:e.id,name:e.name,email:e.email,image:e.picture.data.url}),style:{logo:"/facebook.svg",bg:"#006aff",text:"#fff"},options:e}}},10375:(e,t)=>{t.Z=function(e){return{id:"google",name:"Google",type:"oauth",wellKnown:"https://accounts.google.com/.well-known/openid-configuration",authorization:{params:{scope:"openid email profile"}},idToken:!0,checks:["pkce","state"],profile:e=>({id:e.sub,name:e.name,email:e.email,image:e.picture}),style:{logo:"/google.svg",bg:"#fff",text:"#000"},options:e}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,6521,2455,1355],()=>r(82112));module.exports=a})();