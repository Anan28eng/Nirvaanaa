(()=>{var e={};e.id=9100,e.ids=[9100],e.modules={11185:e=>{"use strict";e.exports=require("mongoose")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},39512:e=>{"use strict";e.exports=require("timers")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},39697:()=>{},62302:()=>{},30107:()=>{},47524:()=>{},55176:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>y,originalPathname:()=>q,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>w,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>S});var i={};r.r(i),r.d(i,{DELETE:()=>p,GET:()=>m,POST:()=>c});var s=r(95419),n=r(69108),o=r(99678),a=r(88578),u=r(87786),d=r(78070),l=r(4595);async function c(e){try{await (0,a.Z)();let t=await e.json();console.debug("[DEBUG] /api/wishlist POST body:",JSON.stringify(t));let{productId:r,name:i,price:s,image:n,slug:o,email:c,items:p,discount:m}=t||{};if(!c)return d.Z.json({error:"email required"},{status:400});let h=await u.Z.findOne({email:c.toLowerCase()});if(!h)return d.Z.json({error:"user not found"},{status:404});return p?h.wishlist=p.map(e=>({...e,discount:e.discount||0})):h.wishlist.find(e=>String(e.productId)===String(r))||h.wishlist.push({productId:r,name:i,price:s,image:n,slug:o,discount:m||0}),await h.save(),(0,l.emitToUser)(c,"wishlist-changed",{items:h.wishlist}),d.Z.json({ok:!0})}catch(e){return console.error(e),d.Z.json({error:"Failed"},{status:500})}}async function p(e){try{await (0,a.Z)();let{searchParams:t}=new URL(e.url),r=t.get("productId"),i=t.get("email");if(!i)return d.Z.json({error:"email required"},{status:400});let s=await u.Z.findOne({email:i.toLowerCase()});if(!s)return d.Z.json({error:"user not found"},{status:404});return s.wishlist=s.wishlist.filter(e=>String(e.productId)!==String(r)),await s.save(),(0,l.emitToUser)(i,"wishlist-changed",{items:s.wishlist}),d.Z.json({ok:!0})}catch(e){return console.error(e),d.Z.json({error:"Failed"},{status:500})}}async function m(e){try{await (0,a.Z)();let{searchParams:t}=new URL(e.url),r=t.get("email");if(!r)return d.Z.json({error:"email required"},{status:400});let i=await u.Z.findOne({email:r.toLowerCase()}).lean();if(!i)return d.Z.json({error:"user not found"},{status:404});return d.Z.json({wishlist:i.wishlist||[]})}catch(e){return console.error(e),d.Z.json({error:"Failed"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/wishlist/route",pathname:"/api/wishlist",filename:"route",bundlePath:"app/api/wishlist/route"},resolvedPagePath:"C:\\Users\\Ananya\\Downloads\\Nirvaanaa_current\\Nirvaanaa (1)\\Nirvaanaa\\app\\api\\wishlist\\route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:w,headerHooks:y,staticGenerationBailout:S}=h,q="/api/wishlist/route";function v(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:f})}},88578:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var i=r(11185),s=r.n(i);let n=process.env.MONGODB_URI;if(!n)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let o=global.mongoose;o||(o=global.mongoose={conn:null,promise:null});let a=async function(){if(o.conn)return o.conn;o.promise||(o.promise=s().connect(n,{bufferCommands:!1}).then(e=>e));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}},4595:(e,t,r)=>{let i;let{Server:s}=r(26371);e.exports={initSocket:e=>((i=new s(e,{cors:{origin:process.env.NEXTAUTH_URL||"http://localhost:3000",methods:["GET","POST"]}})).on("connection",e=>{console.log("Client connected:",e.id),e.on("join-admin",()=>{e.join("admin"),console.log("Admin joined:",e.id)}),e.on("join-user",t=>{e.join(`user-${t}`),console.log("User joined:",t)}),e.on("cart-updated",t=>{e.broadcast.to(`user-${t.userId}`).emit("cart-changed",t)}),e.on("wishlist-updated",t=>{e.broadcast.to(`user-${t.userId}`).emit("wishlist-changed",t)}),e.on("product-updated",t=>{e.broadcast.to("admin").emit("product-changed",t)}),e.on("kpi-updated",t=>{e.broadcast.to("admin").emit("kpi-changed",t)}),e.on("disconnect",()=>{console.log("Client disconnected:",e.id)})}),i),getIO:()=>{if(!i)throw Error("Socket.io not initialized!");return i},emitToUser:(e,t,r)=>{i&&i.to(`user-${e}`).emit(t,r)},emitToAdmin:(e,t)=>{i&&i.to("admin").emit(e,t)},emitToAll:(e,t)=>{i&&i.emit(e,t)}}},87786:(e,t,r)=>{"use strict";r.d(t,{Z:()=>u});var i=r(11185),s=r.n(i),n=r(6521),o=r.n(n);let a=new(s()).Schema({name:{type:String,required:[!0,"Name is required"],trim:!0,maxlength:[50,"Name cannot be more than 50 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,lowercase:!0,trim:!0,match:[/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,"Please enter a valid email"]},passwordHash:{type:String,required:function(){return!this.googleId&&!this.facebookId}},role:{type:String,enum:["user","admin"],default:"user"},googleId:{type:String,sparse:!0},facebookId:{type:String,sparse:!0},image:{type:String},profileImage:{type:String},phone:{type:String,match:[/^\+?[\d\s-()]+$/,"Please enter a valid phone number"]},addresses:[{type:{type:String,enum:["shipping","billing"],required:!0},street:{type:String,required:!0},city:{type:String,required:!0},state:{type:String,required:!0},zipCode:{type:String,required:!0},country:{type:String,required:!0,default:"India"},isDefault:{type:Boolean,default:!1}}],shippingAddress:{name:String,street:String,city:String,state:String,zipCode:String,country:{type:String,default:"India"},phone:String},emailVerified:{type:Boolean,default:!1},isActive:{type:Boolean,default:!0},cart:[{productId:{type:s().Schema.Types.ObjectId,ref:"Product"},name:String,image:String,price:Number,quantity:{type:Number,default:1},slug:String}],wishlist:[{productId:{type:s().Schema.Types.ObjectId,ref:"Product"},name:String,image:String,price:Number,slug:String,addedAt:{type:Date,default:Date.now}}],lastLogin:{type:Date},resetPasswordToken:{type:String},resetPasswordExpires:{type:Date}},{timestamps:!0});a.index({role:1}),a.virtual("password").set(function(e){e&&(this.passwordHash=o().hashSync(e,12))}).get(function(){return this.passwordHash}),a.methods.checkPassword=function(e){return o().compareSync(e,this.passwordHash)},a.methods.getPublicProfile=function(){let e=this.toObject();return delete e.passwordHash,delete e.__v,e},a.statics.findByEmail=function(e){return this.findOne({email:e.toLowerCase()})},a.statics.findAdmins=function(){return this.find({role:"admin"})},a.pre("save",async function(e){if(this.isModified("email")&&await this.constructor.findOne({email:this.email,_id:{$ne:this._id}}))throw Error("Email already exists");e()}),a.set("toJSON",{virtuals:!0,transform:function(e,t){return delete t.passwordHash,delete t.__v,t}});let u=s().models.User||s().model("User",a)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[1638,6206,6521,4136,6371],()=>r(55176));module.exports=i})();