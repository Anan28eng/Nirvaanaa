(()=>{var t={};t.id=6453,t.ids=[6453],t.modules={11185:t=>{"use strict";t.exports=require("mongoose")},30517:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:t=>{"use strict";t.exports=require("buffer")},6113:t=>{"use strict";t.exports=require("crypto")},82361:t=>{"use strict";t.exports=require("events")},57147:t=>{"use strict";t.exports=require("fs")},13685:t=>{"use strict";t.exports=require("http")},95687:t=>{"use strict";t.exports=require("https")},41808:t=>{"use strict";t.exports=require("net")},22037:t=>{"use strict";t.exports=require("os")},71017:t=>{"use strict";t.exports=require("path")},63477:t=>{"use strict";t.exports=require("querystring")},12781:t=>{"use strict";t.exports=require("stream")},39512:t=>{"use strict";t.exports=require("timers")},24404:t=>{"use strict";t.exports=require("tls")},76224:t=>{"use strict";t.exports=require("tty")},57310:t=>{"use strict";t.exports=require("url")},73837:t=>{"use strict";t.exports=require("util")},59796:t=>{"use strict";t.exports=require("zlib")},39697:()=>{},62302:()=>{},30107:()=>{},47524:()=>{},30693:(t,e,r)=>{"use strict";r.r(e),r.d(e,{headerHooks:()=>b,originalPathname:()=>x,patchFetch:()=>v,requestAsyncStorage:()=>y,routeModule:()=>f,serverHooks:()=>w,staticGenerationAsyncStorage:()=>S,staticGenerationBailout:()=>q});var i={};r.r(i),r.d(i,{DELETE:()=>h,GET:()=>p,POST:()=>m,PUT:()=>g});var n=r(95419),a=r(69108),s=r(99678),o=r(88578),u=r(87786),c=r(65537),d=r(78070),l=r(4595);async function p(t){try{await (0,o.Z)();let{searchParams:e}=new URL(t.url),r=e.get("email");if(r){let t=await u.Z.findOne({email:r.toLowerCase()}).lean();return d.Z.json({items:t?.cart||[]})}return d.Z.json({items:[]})}catch(t){return console.error("GET /api/cart",t),d.Z.json({error:"Failed"},{status:500})}}async function m(t){try{await (0,o.Z)();let e=await t.json();console.debug("[DEBUG] /api/cart POST body:",JSON.stringify(e));let{productId:r,name:i,price:n,image:a,quantity:s=1,slug:p,items:m}=e;if(e.email){let t=await u.Z.findOne({email:e.email.toLowerCase()});if(t){if(m){let e=new Map(t.cart.map(t=>[String(t.productId),t.quantity]));for(let t of m){let r=await c.Z.findById(t.productId);if(!r)continue;let i=e.get(String(t.productId))||0,n=(t.quantity||0)-i;if(n>0&&r.stock<n)return d.Z.json({error:`Only ${r.stock} items available for ${r.title}`},{status:400})}for(let r of(t.cart=m.map(t=>({...t,discount:t.discount||0,colorVariant:t.colorVariant||null})),m))try{let t=e.get(String(r.productId))||0,i=(r.quantity||0)-t;if(0!==i){let t=await c.Z.findByIdAndUpdate(r.productId,{$inc:{stock:-i,salesCount:i}},{new:!0}).lean();try{(0,l.emitToAdmin)("product-changed",{action:"updated",product:t})}catch(t){}}}catch(t){}}else{let o=await c.Z.findById(r);if(o&&o.stock<s)return d.Z.json({error:`Only ${o.stock} items available for ${o.title}`},{status:400});let u=t.cart.find(t=>String(t.productId)===String(r));if(u){let t=u.quantity+s;if(o&&o.stock<t)return d.Z.json({error:`Cannot add ${s} more items. Only ${o.stock-u.quantity} available`},{status:400});u.quantity=t;try{await c.Z.findByIdAndUpdate(r,{$inc:{salesCount:s,stock:-s}})}catch(t){}}else{t.cart.push({productId:r,name:i,price:n,discount:e.discount||0,image:a,quantity:s,slug:p,colorVariant:e.colorVariant||null});try{await c.Z.findByIdAndUpdate(r,{$inc:{salesCount:s,stock:-s}})}catch(t){}}}await t.save(),(0,l.emitToUser)(e.email,"cart-changed",{items:t.cart});try{if(r){let t=await c.Z.findById(r).lean();(0,l.emitToAdmin)("product-changed",{action:"updated",product:t}),(0,l.emitToAll)("product-changed",{action:"updated",product:t})}}catch(t){}}}return d.Z.json({ok:!0})}catch(t){return console.error(t),d.Z.json({error:"Failed"},{status:500})}}async function g(t){try{await (0,o.Z)();let{productId:e,quantity:r,email:i}=await t.json();if(!i)return d.Z.json({error:"email required"},{status:400});let n=await u.Z.findOne({email:i.toLowerCase()});if(!n)return d.Z.json({error:"user not found"},{status:404});let a=n.cart.find(t=>String(t.productId)===String(e));if(!a)return d.Z.json({error:"item not in cart"},{status:404});let s=a.quantity,p=r-s;if(0!==p){let t=await c.Z.findById(e);if(!t)return d.Z.json({error:"product not found"},{status:404});if(p>0&&t.stock<p)return d.Z.json({error:`Only ${t.stock} items available for ${t.title}`},{status:400});let r=await c.Z.findByIdAndUpdate(e,{$inc:{stock:-p,salesCount:p}},{new:!0}).lean();try{(0,l.emitToAdmin)("product-changed",{action:"updated",product:r})}catch(t){}}return a.quantity=r,await n.save(),(0,l.emitToUser)(i,"cart-changed",{items:n.cart}),d.Z.json({ok:!0})}catch(t){return console.error(t),d.Z.json({error:"Failed"},{status:500})}}async function h(t){try{let e,r;if(await (0,o.Z)(),(t.headers.get("content-type")||"").includes("application/json")){let i=await t.json();e=i.productId,r=i.email}else{let{searchParams:i}=new URL(t.url);e=i.get("productId"),r=i.get("email")}if(!r)return d.Z.json({error:"email required"},{status:400});let i=await u.Z.findOne({email:r.toLowerCase()});if(!i)return d.Z.json({error:"user not found"},{status:404});let n=i.cart.find(t=>String(t.productId)===String(e));if(n)try{let t=await c.Z.findByIdAndUpdate(e,{$inc:{stock:n.quantity,salesCount:-n.quantity}},{new:!0}).lean();try{(0,l.emitToAdmin)("product-changed",{action:"updated",product:t})}catch(t){}}catch(t){}return i.cart=i.cart.filter(t=>String(t.productId)!==String(e)),await i.save(),(0,l.emitToUser)(r,"cart-changed",{items:i.cart}),d.Z.json({ok:!0})}catch(t){return console.error(t),d.Z.json({error:"Failed"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/cart/route",pathname:"/api/cart",filename:"route",bundlePath:"app/api/cart/route"},resolvedPagePath:"C:\\Users\\Ananya\\Downloads\\Nirvaanaa_current\\Nirvaanaa (1)\\Nirvaanaa\\app\\api\\cart\\route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:y,staticGenerationAsyncStorage:S,serverHooks:w,headerHooks:b,staticGenerationBailout:q}=f,x="/api/cart/route";function v(){return(0,s.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:S})}},88578:(t,e,r)=>{"use strict";r.d(e,{Z:()=>o});var i=r(11185),n=r.n(i);let a=process.env.MONGODB_URI;if(!a)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let s=global.mongoose;s||(s=global.mongoose={conn:null,promise:null});let o=async function(){if(s.conn)return s.conn;s.promise||(s.promise=n().connect(a,{bufferCommands:!1}).then(t=>t));try{s.conn=await s.promise}catch(t){throw s.promise=null,t}return s.conn}},4595:(t,e,r)=>{let i;let{Server:n}=r(26371);t.exports={initSocket:t=>((i=new n(t,{cors:{origin:process.env.NEXTAUTH_URL||"http://localhost:3000",methods:["GET","POST"]}})).on("connection",t=>{console.log("Client connected:",t.id),t.on("join-admin",()=>{t.join("admin"),console.log("Admin joined:",t.id)}),t.on("join-user",e=>{t.join(`user-${e}`),console.log("User joined:",e)}),t.on("cart-updated",e=>{t.broadcast.to(`user-${e.userId}`).emit("cart-changed",e)}),t.on("wishlist-updated",e=>{t.broadcast.to(`user-${e.userId}`).emit("wishlist-changed",e)}),t.on("product-updated",e=>{t.broadcast.to("admin").emit("product-changed",e)}),t.on("kpi-updated",e=>{t.broadcast.to("admin").emit("kpi-changed",e)}),t.on("disconnect",()=>{console.log("Client disconnected:",t.id)})}),i),getIO:()=>{if(!i)throw Error("Socket.io not initialized!");return i},emitToUser:(t,e,r)=>{i&&i.to(`user-${t}`).emit(e,r)},emitToAdmin:(t,e)=>{i&&i.to("admin").emit(t,e)},emitToAll:(t,e)=>{i&&i.emit(t,e)}}},65537:(t,e,r)=>{"use strict";r.d(e,{Z:()=>s});var i=r(11185),n=r.n(i);let a=new(n()).Schema({title:{type:String,required:[!0,"Product title is required"],trim:!0,maxlength:[100,"Title cannot be more than 100 characters"]},slug:{type:String,required:[!0,"Product slug is required"],unique:!0,lowercase:!0,trim:!0,match:[/^[a-z0-9-]+$/,"Slug can only contain lowercase letters, numbers, and hyphens"]},description:{type:String,required:[!0,"Product description is required"],maxlength:[2e3,"Description cannot be more than 2000 characters"]},shortDescription:{type:String,maxlength:[200,"Short description cannot be more than 200 characters"]},images:[{url:{type:String,required:!0},alt:{type:String,required:!0},publicId:{type:String,required:!0}}],price:{type:Number,required:[!0,"Product price is required"],min:[0,"Price cannot be negative"]},discount:{type:Number,min:[0,"Discount cannot be negative"],max:[100,"Discount cannot be more than 100%"],default:0},comparePrice:{type:Number,min:[0,"Compare price cannot be negative"]},stock:{type:Number,required:[!0,"Stock quantity is required"],min:[0,"Stock cannot be negative"],default:10},sku:{type:String,unique:!0,sparse:!0,trim:!0},tags:[{type:String,trim:!0,lowercase:!0}],category:{type:String,required:[!0,"Product category is required"],enum:["bangle-box","clutch","gift-hampers","goggle-cover","kitty-bag","long-tote-bag","picnic-bag","potli-purse","sling-bags","velvet-clutch-with-flaps"]},subcategory:{type:String,trim:!0},materials:[{type:String,trim:!0}],dimensions:{length:Number,width:Number,height:Number,unit:{type:String,enum:["cm","inches"],default:"cm"}},weight:{value:Number,unit:{type:String,enum:["g","kg","lbs"],default:"g"}},colors:[{name:String,hex:String}],colorVariants:[{name:{type:String,required:!0,trim:!0},hex:{type:String,required:!0,match:[/^#[0-9A-Fa-f]{6}$/,"Hex color must be in format #RRGGBB"]},images:[{type:String,trim:!0}]}],published:{type:Boolean,default:!0},featured:{type:Boolean,default:!1},seo:{metaTitle:{type:String,maxlength:[60,"Meta title cannot be more than 60 characters"]},metaDescription:{type:String,maxlength:[160,"Meta description cannot be more than 160 characters"]},keywords:[String]},ratings:{average:{type:Number,default:0,min:0,max:5},count:{type:Number,default:0,min:0}},salesCount:{type:Number,default:0,min:0},isHandmade:{type:Boolean,default:!0},madeIn:{type:String,default:"India"},careInstructions:{type:String,maxlength:[500,"Care instructions cannot be more than 500 characters"]}},{timestamps:!0});a.index({slug:1}),a.index({category:1}),a.index({tags:1}),a.index({published:1}),a.index({featured:1}),a.index({"ratings.average":-1}),a.index({salesCount:-1}),a.index({createdAt:-1}),a.set("toJSON",{virtuals:!0,transform:function(t,e){return delete e.__v,e}}),a.virtual("discountPercentage").get(function(){return this.comparePrice&&this.comparePrice>this.price?Math.round((this.comparePrice-this.price)/this.comparePrice*100):0}),a.virtual("inStock").get(function(){return this.stock>0}),a.virtual("mainImage").get(function(){return this.images.length>0?this.images[0]:null}),a.methods.updateStock=function(t){return this.stock=Math.max(0,this.stock-t),this.save()},a.methods.incrementSales=function(t=1){return this.salesCount+=t,this.save()},a.statics.findPublished=function(){return this.find({published:!0})},a.statics.findFeatured=function(){return this.find({published:!0,featured:!0})},a.statics.findByCategory=function(t){return this.find({published:!0,category:t})},a.statics.search=function(t){return this.find({published:!0,$or:[{title:{$regex:t,$options:"i"}},{description:{$regex:t,$options:"i"}},{tags:{$in:[RegExp(t,"i")]}}]})},a.pre("save",function(t){!this.slug&&this.title&&(this.slug=this.title.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-")),t()}),a.set("toJSON",{virtuals:!0,transform:function(t,e){return delete e.__v,e}});let s=n().models.Product||n().model("Product",a)},87786:(t,e,r)=>{"use strict";r.d(e,{Z:()=>u});var i=r(11185),n=r.n(i),a=r(6521),s=r.n(a);let o=new(n()).Schema({name:{type:String,required:[!0,"Name is required"],trim:!0,maxlength:[50,"Name cannot be more than 50 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,lowercase:!0,trim:!0,match:[/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,"Please enter a valid email"]},passwordHash:{type:String,required:function(){return!this.googleId&&!this.facebookId}},role:{type:String,enum:["user","admin"],default:"user"},googleId:{type:String,sparse:!0},facebookId:{type:String,sparse:!0},image:{type:String},profileImage:{type:String},phone:{type:String,match:[/^\+?[\d\s-()]+$/,"Please enter a valid phone number"]},addresses:[{type:{type:String,enum:["shipping","billing"],required:!0},street:{type:String,required:!0},city:{type:String,required:!0},state:{type:String,required:!0},zipCode:{type:String,required:!0},country:{type:String,required:!0,default:"India"},isDefault:{type:Boolean,default:!1}}],shippingAddress:{name:String,street:String,city:String,state:String,zipCode:String,country:{type:String,default:"India"},phone:String},emailVerified:{type:Boolean,default:!1},isActive:{type:Boolean,default:!0},cart:[{productId:{type:n().Schema.Types.ObjectId,ref:"Product"},name:String,image:String,price:Number,quantity:{type:Number,default:1},slug:String}],wishlist:[{productId:{type:n().Schema.Types.ObjectId,ref:"Product"},name:String,image:String,price:Number,slug:String,addedAt:{type:Date,default:Date.now}}],lastLogin:{type:Date},resetPasswordToken:{type:String},resetPasswordExpires:{type:Date}},{timestamps:!0});o.index({email:1}),o.index({googleId:1}),o.index({facebookId:1}),o.index({role:1}),o.virtual("password").set(function(t){t&&(this.passwordHash=s().hashSync(t,12))}).get(function(){return this.passwordHash}),o.methods.checkPassword=function(t){return s().compareSync(t,this.passwordHash)},o.methods.getPublicProfile=function(){let t=this.toObject();return delete t.passwordHash,delete t.__v,t},o.statics.findByEmail=function(t){return this.findOne({email:t.toLowerCase()})},o.statics.findAdmins=function(){return this.find({role:"admin"})},o.pre("save",async function(t){if(this.isModified("email")&&await this.constructor.findOne({email:this.email,_id:{$ne:this._id}}))throw Error("Email already exists");t()}),o.set("toJSON",{virtuals:!0,transform:function(t,e){return delete e.passwordHash,delete e.__v,e}});let u=n().models.User||n().model("User",o)}};var e=require("../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),i=e.X(0,[1638,6206,6521,4136,6371],()=>r(30693));module.exports=i})();