"use strict";(()=>{var e={};e.id=4575,e.ids=[4575],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},90006:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>q,originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x,staticGenerationBailout:()=>v});var i={};r.r(i),r.d(i,{GET:()=>d,POST:()=>h});var s=r(95419),a=r(69108),n=r(99678),o=r(78070),u=r(81355),p=r(82242),c=r(88578),l=r(74145);async function d(e){try{let t=await (0,u.getServerSession)(p.authOptions),r=t?.user?.role==="admin";await (0,c.Z)();let{searchParams:i}=new URL(e.url),s=parseFloat(i.get("orderTotal"))||0,a=parseFloat(i.get("weight"))||0,n=i.get("dimensions")?JSON.parse(i.get("dimensions")):null;if(s>0){let e=await l.Z.calculateShipping(s,a,n);return o.Z.json({shipping:e,methods:await l.Z.findActive()})}let d=r?await l.Z.find().sort({cost:1}):await l.Z.findActive();return o.Z.json({methods:d})}catch(e){return console.error("Error fetching shipping methods:",e),o.Z.json({error:"Failed to fetch shipping methods"},{status:500})}}async function h(e){try{let t=await (0,u.getServerSession)(p.authOptions);if(!t||"admin"!==t.user.role)return o.Z.json({error:"Admin access required"},{status:403});await (0,c.Z)();let r=await e.json(),{name:i,description:s,cost:a,estimatedDays:n,freeShippingThreshold:d,applicableRegions:h,weightLimit:g,dimensionsLimit:m,gstPercent:x}=r;if(!i||!a||!n)return o.Z.json({error:"Name, cost, and estimated days are required"},{status:400});r.isDefault&&await l.Z.updateMany({},{isDefault:!1});let f=new l.Z({name:i,description:s,cost:a,estimatedDays:n,freeShippingThreshold:d,applicableRegions:h,weightLimit:g,dimensionsLimit:m,isActive:!1!==r.isActive,isDefault:r.isDefault||!1,gstPercent:"number"==typeof x?x:void 0});return await f.save(),o.Z.json({message:"Shipping method created successfully",method:f})}catch(e){return console.error("Error creating shipping method:",e),o.Z.json({error:"Failed to create shipping method"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/shipping/route",pathname:"/api/shipping",filename:"route",bundlePath:"app/api/shipping/route"},resolvedPagePath:"C:\\Users\\Ananya\\Downloads\\Nirvaanaa_current\\Nirvaanaa (1)\\Nirvaanaa\\app\\api\\shipping\\route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:m,staticGenerationAsyncStorage:x,serverHooks:f,headerHooks:q,staticGenerationBailout:v}=g,w="/api/shipping/route";function y(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[1638,6206,6521,2455,1355,1671],()=>r(90006));module.exports=i})();