(()=>{var e={};e.id=9146,e.ids=[9146,2242],e.modules={11185:e=>{"use strict";e.exports=require("mongoose")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},39512:e=>{"use strict";e.exports=require("timers")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},39697:()=>{},62302:()=>{},30107:()=>{},47524:()=>{},3606:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>w,originalPathname:()=>v,patchFetch:()=>q,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>S,staticGenerationAsyncStorage:()=>y,staticGenerationBailout:()=>b});var i={};r.r(i),r.d(i,{GET:()=>m,POST:()=>g});var a=r(95419),n=r(69108),s=r(99678),o=r(78070),d=r(88578),u=r(50798),l=r(81355),c=r(82242),p=r(4595);async function m(e){try{let t=await (0,l.getServerSession)(c.authOptions);if(!t||"admin"!==t.user.role)return o.Z.json({error:"Unauthorized"},{status:401});await (0,d.Z)();let{searchParams:r}=new URL(e.url),i=parseInt(r.get("page"))||1,a=parseInt(r.get("limit"))||20,n=r.get("status"),s=r.get("paymentStatus"),p=r.get("search"),m=r.get("sort")||"createdAt",g=r.get("order")||"desc",h={};n&&(h.status=n),s&&(h.paymentStatus=s),p&&(h.$or=[{orderNumber:{$regex:p,$options:"i"}},{"shippingAddress.name":{$regex:p,$options:"i"}},{"shippingAddress.phone":{$regex:p,$options:"i"}}]);let f={};f[m]="desc"===g?-1:1;let y=(i-1)*a,[S,w]=await Promise.all([u.Z.find(h).populate("userId","name email").sort(f).skip(y).limit(a).lean(),u.Z.countDocuments(h)]),b=Math.ceil(w/a);return o.Z.json({orders:S,pagination:{page:i,limit:a,total:w,totalPages:b,hasNextPage:i<b,hasPrevPage:i>1}})}catch(e){return console.error("Orders API error:",e),o.Z.json({error:"Failed to fetch orders"},{status:500})}}async function g(e){try{let t=await (0,l.getServerSession)(c.authOptions);if(!t||"admin"!==t.user.role)return o.Z.json({error:"Unauthorized"},{status:401});await (0,d.Z)();let{userId:r,items:i,shippingAddress:a,billingAddress:n,paymentMethod:s}=await e.json();if(!r||!i||!a||!n||!s)return o.Z.json({error:"Missing required fields"},{status:400});let m=i.reduce((e,t)=>e+t.price*t.quantity,0),g=.18*m,h=new u.Z({userId:r,items:i,subtotal:m,tax:g,shipping:0,discount:0,total:m+g+0-0,paymentMethod:s,shippingAddress:a,billingAddress:n,status:"pending",paymentStatus:"pending"});await h.save();try{(0,p.emitToAdmin)("order-changed",{action:"created",order:h.toObject()}),(0,p.emitToAll)("order-changed",{action:"created",order:h.toObject()})}catch(e){}return o.Z.json(h,{status:201})}catch(e){return console.error("Create order error:",e),o.Z.json({error:"Failed to create order"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/orders/route",pathname:"/api/orders",filename:"route",bundlePath:"app/api/orders/route"},resolvedPagePath:"C:\\Users\\Ananya\\Downloads\\Nirvaanaa_current\\Nirvaanaa (1)\\Nirvaanaa\\app\\api\\orders\\route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:S,headerHooks:w,staticGenerationBailout:b}=h,v="/api/orders/route";function q(){return(0,s.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:y})}},82242:(e,t,r)=>{"use strict";r.d(t,{authOptions:()=>l});var i=r(86485),a=r(10375),n=r(98904),s=r(88578),o=r(87786),d=r(6521),u=r.n(d);let l={providers:[(0,i.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Email and password are required");await (0,s.Z)();let t=await o.Z.findOne({email:e.email});if(!t)throw Error("Invalid email or password");if(!t.passwordHash)throw Error("Please sign in with your social account");if(!await u().compare(e.password,t.passwordHash))throw Error("Invalid email or password");if(!t.isActive)throw Error("Account is deactivated");return{id:t._id.toString(),name:t.name,email:t.email,role:t.role,image:t.image}}}),(0,a.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}),(0,n.Z)({clientId:process.env.FACEBOOK_CLIENT_ID,clientSecret:process.env.FACEBOOK_CLIENT_SECRET})],callbacks:{async signIn({user:e,account:t,profile:r}){if(t?.provider==="google"||t?.provider==="facebook"){await (0,s.Z)();let i=await o.Z.findOne({$or:[{email:e.email},{googleId:"google"===t.provider?r.sub:null},{facebookId:"facebook"===t.provider?r.id:null}]});if(i)return"google"!==t.provider||i.googleId?"facebook"!==t.provider||i.facebookId||(i.facebookId=r.id,i.image=e.image,await i.save()):(i.googleId=r.sub,i.image=e.image,await i.save()),i.isActive;{let i=new o.Z({name:e.name,email:e.email,image:e.image,googleId:"google"===t.provider?r.sub:null,facebookId:"facebook"===t.provider?r.id:null,emailVerified:!0});return await i.save(),!0}}try{await (0,s.Z)();let t=await o.Z.findOne({email:e.email});t&&(t.lastLogin=new Date,await t.save())}catch(e){}return!0},async jwt({token:e,user:t,account:r}){if(t&&(e.role=t.role,e.id=t.id,"admin"===t.role&&(e.maxAge=7200)),r?.provider==="google"||r?.provider==="facebook"){await (0,s.Z)();let t=await o.Z.findOne({email:e.email});t&&(e.role=t.role,e.id=t._id.toString(),"admin"===t.role&&(e.maxAge=7200))}if("admin"===e.role&&e.maxAge){let t=Math.floor(Date.now()/1e3),r=e.iat||t;if(t-r>e.maxAge)return null}return e},async session({session:e,token:t}){if(t&&(e.user.id=t.id,e.user.role=t.role,"admin"===t.role)){await (0,s.Z)();let r=await o.Z.findById(t.id);r&&"admin"===r.role&&r.isActive||(e.user.role="user")}return e}},pages:{signIn:"/auth/signin",error:"/auth/error"},session:{strategy:"jwt",maxAge:2592e3},cookies:{sessionToken:{name:"next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}},callbackUrl:{name:"next-auth.callback-url",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}},csrfToken:{name:"next-auth.csrf-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}},secret:process.env.NEXTAUTH_SECRET,debug:!1}},88578:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var i=r(11185),a=r.n(i);let n=process.env.MONGODB_URI;if(!n)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let s=global.mongoose;s||(s=global.mongoose={conn:null,promise:null});let o=async function(){if(s.conn)return s.conn;s.promise||(s.promise=a().connect(n,{bufferCommands:!1}).then(e=>e));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}},4595:(e,t,r)=>{let i;let{Server:a}=r(26371);e.exports={initSocket:e=>((i=new a(e,{cors:{origin:process.env.NEXTAUTH_URL||"http://localhost:3000",methods:["GET","POST"]}})).on("connection",e=>{console.log("Client connected:",e.id),e.on("join-admin",()=>{e.join("admin"),console.log("Admin joined:",e.id)}),e.on("join-user",t=>{e.join(`user-${t}`),console.log("User joined:",t)}),e.on("cart-updated",t=>{e.broadcast.to(`user-${t.userId}`).emit("cart-changed",t)}),e.on("wishlist-updated",t=>{e.broadcast.to(`user-${t.userId}`).emit("wishlist-changed",t)}),e.on("product-updated",t=>{e.broadcast.to("admin").emit("product-changed",t)}),e.on("kpi-updated",t=>{e.broadcast.to("admin").emit("kpi-changed",t)}),e.on("disconnect",()=>{console.log("Client disconnected:",e.id)})}),i),getIO:()=>{if(!i)throw Error("Socket.io not initialized!");return i},emitToUser:(e,t,r)=>{i&&i.to(`user-${e}`).emit(t,r)},emitToAdmin:(e,t)=>{i&&i.to("admin").emit(e,t)},emitToAll:(e,t)=>{i&&i.emit(e,t)}}},50798:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var i=r(11185),a=r.n(i);let n=new(a()).Schema({orderNumber:{type:String,unique:!0},userId:{type:a().Schema.Types.ObjectId,ref:"User",required:!0},items:[{productId:{type:a().Schema.Types.ObjectId,ref:"Product",required:!0},name:{type:String,required:!0},image:{type:String,required:!0},price:{type:Number,required:!0,min:0},originalPrice:{type:Number,min:0,default:0},discount:{type:Number,min:0,default:0},quantity:{type:Number,required:!0,min:1},sku:String,colorVariant:{name:String,hex:String,images:[String]}}],subtotal:{type:Number,required:!0,min:0},tax:{type:Number,required:!0,min:0,default:0},shipping:{type:Number,required:!0,min:0,default:0},discount:{type:Number,required:!0,min:0,default:0},total:{type:Number,required:!0,min:0},currency:{type:String,required:!0,default:"INR"},status:{type:String,enum:["pending","processing","shipped","delivered","cancelled","refunded"],default:"pending"},paymentStatus:{type:String,enum:["pending","paid","failed","refunded"],default:"pending"},paymentMethod:{type:String,enum:["razorpay","cod"],required:!0},razorpayOrderId:{type:String,sparse:!0},razorpayPaymentId:{type:String,sparse:!0},shippingAddress:{name:{type:String,required:!0},phone:{type:String,required:!0},street:{type:String,required:!0},city:{type:String,required:!0},state:{type:String,required:!0},zipCode:{type:String,required:!0},country:{type:String,required:!0,default:"India"}},billingAddress:{name:{type:String,required:!0},phone:{type:String,required:!0},street:{type:String,required:!0},city:{type:String,required:!0},state:{type:String,required:!0},zipCode:{type:String,required:!0},country:{type:String,required:!0,default:"India"}},shippingMethod:{name:{type:String,required:!0,default:"Standard Shipping"},estimatedDays:{type:Number,required:!0,default:5},trackingNumber:String,trackingUrl:String},notes:{customer:String,admin:String},timeline:[{status:{type:String,required:!0},message:{type:String,required:!0},timestamp:{type:Date,default:Date.now},updatedBy:{type:a().Schema.Types.ObjectId,ref:"User"}}],emailSent:{confirmation:{type:Boolean,default:!1},shipped:{type:Boolean,default:!1},delivered:{type:Boolean,default:!1}},smsSent:{confirmation:{type:Boolean,default:!1},shipped:{type:Boolean,default:!1},delivered:{type:Boolean,default:!1}},refundAmount:{type:Number,min:0},refundReason:String,cancelledAt:Date,cancelledBy:{type:a().Schema.Types.ObjectId,ref:"User"},deliveredAt:Date},{timestamps:!0});n.index({userId:1}),n.index({status:1}),n.index({paymentStatus:1}),n.index({createdAt:-1}),n.index({"shippingAddress.phone":1}),n.virtual("orderSummary").get(function(){return{orderNumber:this.orderNumber,total:this.total,status:this.status,itemCount:this.items.length,createdAt:this.createdAt}}),n.virtual("customerInfo").get(function(){return{name:this.shippingAddress.name,phone:this.shippingAddress.phone,email:this.userId?.email}}),n.methods.addTimelineEntry=function(e,t,r=null){return this.timeline.push({status:e,message:t,timestamp:new Date,updatedBy:r}),this.save()},n.methods.updateStatus=function(e,t,r=null){return this.status=e,this.addTimelineEntry(e,t,r),"delivered"===e&&(this.deliveredAt=new Date),"cancelled"===e&&(this.cancelledAt=new Date,this.cancelledBy=r),this.save()},n.methods.calculateTotals=function(){return this.subtotal=this.items.reduce((e,t)=>e+t.price*t.quantity,0),this.total=this.subtotal+this.tax+this.shipping-this.discount,this.save()},n.statics.generateOrderNumber=async function(){let e=new Date,t=e.getFullYear().toString().slice(-2),r=(e.getMonth()+1).toString().padStart(2,"0"),i=e.getDate().toString().padStart(2,"0"),a=new Date(e.getFullYear(),e.getMonth(),e.getDate()),n=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1),s=(await this.countDocuments({createdAt:{$gte:a,$lt:n}})+1).toString().padStart(3,"0");return`NV${t}${r}${i}${s}`},n.statics.findByUser=function(e){return this.find({userId:e}).sort({createdAt:-1})},n.statics.findPending=function(){return this.find({status:"pending"}).sort({createdAt:-1})},n.statics.findByStatus=function(e){return this.find({status:e}).sort({createdAt:-1})},n.pre("save",async function(e){this.isNew&&!this.orderNumber&&(this.orderNumber=await this.constructor.generateOrderNumber()),e()}),n.set("toJSON",{virtuals:!0,transform:function(e,t){return delete t.__v,t}});let s=a().models.Order||a().model("Order",n)},87786:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});var i=r(11185),a=r.n(i),n=r(6521),s=r.n(n);let o=new(a()).Schema({name:{type:String,required:[!0,"Name is required"],trim:!0,maxlength:[50,"Name cannot be more than 50 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,lowercase:!0,trim:!0,match:[/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,"Please enter a valid email"]},passwordHash:{type:String,required:function(){return!this.googleId&&!this.facebookId}},role:{type:String,enum:["user","admin"],default:"user"},googleId:{type:String,sparse:!0},facebookId:{type:String,sparse:!0},image:{type:String},profileImage:{type:String},phone:{type:String,match:[/^\+?[\d\s-()]+$/,"Please enter a valid phone number"]},addresses:[{type:{type:String,enum:["shipping","billing"],required:!0},street:{type:String,required:!0},city:{type:String,required:!0},state:{type:String,required:!0},zipCode:{type:String,required:!0},country:{type:String,required:!0,default:"India"},isDefault:{type:Boolean,default:!1}}],shippingAddress:{name:String,street:String,city:String,state:String,zipCode:String,country:{type:String,default:"India"},phone:String},emailVerified:{type:Boolean,default:!1},isActive:{type:Boolean,default:!0},cart:[{productId:{type:a().Schema.Types.ObjectId,ref:"Product"},name:String,image:String,price:Number,quantity:{type:Number,default:1},slug:String}],wishlist:[{productId:{type:a().Schema.Types.ObjectId,ref:"Product"},name:String,image:String,price:Number,slug:String,addedAt:{type:Date,default:Date.now}}],lastLogin:{type:Date},resetPasswordToken:{type:String},resetPasswordExpires:{type:Date}},{timestamps:!0});o.index({role:1}),o.virtual("password").set(function(e){e&&(this.passwordHash=s().hashSync(e,12))}).get(function(){return this.passwordHash}),o.methods.checkPassword=function(e){return s().compareSync(e,this.passwordHash)},o.methods.getPublicProfile=function(){let e=this.toObject();return delete e.passwordHash,delete e.__v,e},o.statics.findByEmail=function(e){return this.findOne({email:e.toLowerCase()})},o.statics.findAdmins=function(){return this.find({role:"admin"})},o.pre("save",async function(e){if(this.isModified("email")&&await this.constructor.findOne({email:this.email,_id:{$ne:this._id}}))throw Error("Email already exists");e()}),o.set("toJSON",{virtuals:!0,transform:function(e,t){return delete t.passwordHash,delete t.__v,t}});let d=a().models.User||a().model("User",o)},86485:(e,t)=>{"use strict";t.Z=function(e){return{id:"credentials",name:"Credentials",type:"credentials",credentials:{},authorize:()=>null,options:e}}},98904:(e,t)=>{"use strict";t.Z=function(e){return{id:"facebook",name:"Facebook",type:"oauth",authorization:"https://www.facebook.com/v11.0/dialog/oauth?scope=email",token:"https://graph.facebook.com/oauth/access_token",userinfo:{url:"https://graph.facebook.com/me",params:{fields:"id,name,email,picture"},async request({tokens:e,client:t,provider:r}){var i;return await t.userinfo(e.access_token,{params:null===(i=r.userinfo)||void 0===i?void 0:i.params})}},profile:e=>({id:e.id,name:e.name,email:e.email,image:e.picture.data.url}),style:{logo:"/facebook.svg",bg:"#006aff",text:"#fff"},options:e}}},10375:(e,t)=>{"use strict";t.Z=function(e){return{id:"google",name:"Google",type:"oauth",wellKnown:"https://accounts.google.com/.well-known/openid-configuration",authorization:{params:{scope:"openid email profile"}},idToken:!0,checks:["pkce","state"],profile:e=>({id:e.sub,name:e.name,email:e.email,image:e.picture}),style:{logo:"/google.svg",bg:"#fff",text:"#000"},options:e}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[1638,6206,6521,2455,1355,4136,6371],()=>r(3606));module.exports=i})();