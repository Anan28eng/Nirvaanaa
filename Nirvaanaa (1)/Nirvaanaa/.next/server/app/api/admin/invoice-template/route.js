"use strict";(()=>{var e={};e.id=5843,e.ids=[5843],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},71017:e=>{e.exports=require("path")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},4945:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>Z,originalPathname:()=>P,patchFetch:()=>O,requestAsyncStorage:()=>h,routeModule:()=>y,serverHooks:()=>j,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>A});var a={};r.r(a),r.d(a,{GET:()=>q,POST:()=>w});var o=r(95419),i=r(69108),s=r(99678),n=r(78070),u=r(81355),p=r(82242),l=r(88578),c=r(7721),d=r(71017),m=r.n(d),x=r(57147),f=r.n(x);let v=process.env.INVOICE_UPLOAD_DIR||m().join(process.cwd(),"uploads","invoices");async function q(){try{await (0,l.Z)();let e=await c.Z.find().sort({uploadedAt:-1});return n.Z.json({templates:e})}catch(e){return console.error("List invoice templates error:",e),n.Z.json({error:"Failed to list templates"},{status:500})}}async function w(e){try{let t=await (0,u.getServerSession)(p.authOptions);if(!t||"admin"!==t.user.role)return n.Z.json({error:"Admin access required"},{status:403});let r=(await e.formData()).get("file");if(!r)return n.Z.json({error:"No file uploaded"},{status:400});let a=r.name||"template.docx";if(!a.toLowerCase().endsWith(".docx"))return n.Z.json({error:"Only .docx files are allowed"},{status:400});f().existsSync(v)||f().mkdirSync(v,{recursive:!0});let o=`${Date.now()}-${a.replace(/\s+/g,"_")}`,i=m().join(v,o),s=await r.arrayBuffer(),d=Buffer.from(s);await f().promises.writeFile(i,d),await (0,l.Z)();let x=await c.Z.create({filename:o,originalName:a,path:i,mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",uploadedBy:t.user.id,uploadedAt:new Date});return n.Z.json({template:x},{status:201})}catch(e){return console.error("Upload invoice template error:",e),n.Z.json({error:"Failed to upload template"},{status:500})}}let y=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/invoice-template/route",pathname:"/api/admin/invoice-template",filename:"route",bundlePath:"app/api/admin/invoice-template/route"},resolvedPagePath:"C:\\Users\\Ananya\\Downloads\\Nirvaanaa_current\\Nirvaanaa (1)\\Nirvaanaa\\app\\api\\admin\\invoice-template\\route.js",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:j,headerHooks:Z,staticGenerationBailout:A}=y,P="/api/admin/invoice-template/route";function O(){return(0,s.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:g})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,6521,2455,1355,567],()=>r(4945));module.exports=a})();