"use strict";(()=>{var e={};e.id=1567,e.ids=[1567],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},59899:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>h,originalPathname:()=>f,patchFetch:()=>q,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>y,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>S});var i={};r.r(i),r.d(i,{GET:()=>l});var n=r(95419),a=r(69108),s=r(99678),d=r(78070),o=r(88578),u=r(50798),p=r(87786);async function l(e){try{await (0,o.Z)();let{searchParams:t}=new URL(e.url),r=t.get("range")||"month",i=new Date;i.setDate(i.getDate()-(("year"===r?365:"month"===r?30:"week"===r?7:1)-1));let n=await u.Z.aggregate([{$match:{createdAt:{$gte:i},paymentStatus:{$in:["paid","succeeded"]}}},{$group:{_id:{$dateToString:{format:"%Y-%m-%d",date:"$createdAt"}},totalRevenue:{$sum:"$total"},totalOrders:{$sum:1}}},{$sort:{_id:1}}]),a=await p.Z.aggregate([{$match:{lastLogin:{$gte:i}}},{$group:{_id:{$dateToString:{format:"%Y-%m-%d",date:"$lastLogin"}},loggedIn:{$sum:1}}},{$sort:{_id:1}}]),s=(e,t)=>{let r=new Map;e.forEach(e=>r.set(e._id,e[t]||0));let n=[],a=new Date(i),s=new Date;for(;a<=s;){let e=a.getFullYear(),t=String(a.getMonth()+1).padStart(2,"0"),i=String(a.getDate()).padStart(2,"0"),s=`${e}-${t}-${i}`;n.push({date:s,value:r.get(s)||0}),a.setDate(a.getDate()+1)}return n},l=s(n,"totalRevenue"),c=s(n,"totalOrders"),m=s(a,"loggedIn");return d.Z.json({revenue:l,orders:c,customers:m,kpis:[]})}catch(e){return console.error("Analytics API error:",e),d.Z.json({error:"Internal Server Error"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/analytics/route",pathname:"/api/analytics",filename:"route",bundlePath:"app/api/analytics/route"},resolvedPagePath:"C:\\Users\\Ananya\\Downloads\\Nirvaanaa_current\\Nirvaanaa (1)\\Nirvaanaa\\app\\api\\analytics\\route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:y,headerHooks:h,staticGenerationBailout:S}=c,f="/api/analytics/route";function q(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:g})}},88578:(e,t,r)=>{r.d(t,{Z:()=>d});var i=r(11185),n=r.n(i);let a=process.env.MONGODB_URI;if(!a)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let s=global.mongoose;s||(s=global.mongoose={conn:null,promise:null});let d=async function(){if(s.conn)return s.conn;s.promise||(s.promise=n().connect(a,{bufferCommands:!1}).then(e=>e));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}},50798:(e,t,r)=>{r.d(t,{Z:()=>s});var i=r(11185),n=r.n(i);let a=new(n()).Schema({orderNumber:{type:String,unique:!0},userId:{type:n().Schema.Types.ObjectId,ref:"User",required:!0},items:[{productId:{type:n().Schema.Types.ObjectId,ref:"Product",required:!0},name:{type:String,required:!0},image:{type:String,required:!0},price:{type:Number,required:!0,min:0},originalPrice:{type:Number,min:0,default:0},discount:{type:Number,min:0,default:0},quantity:{type:Number,required:!0,min:1},sku:String,colorVariant:{name:String,hex:String,images:[String]}}],subtotal:{type:Number,required:!0,min:0},tax:{type:Number,required:!0,min:0,default:0},shipping:{type:Number,required:!0,min:0,default:0},discount:{type:Number,required:!0,min:0,default:0},total:{type:Number,required:!0,min:0},currency:{type:String,required:!0,default:"INR"},status:{type:String,enum:["pending","processing","shipped","delivered","cancelled","refunded"],default:"pending"},paymentStatus:{type:String,enum:["pending","paid","failed","refunded"],default:"pending"},paymentMethod:{type:String,enum:["razorpay","cod"],required:!0},razorpayOrderId:{type:String,sparse:!0},razorpayPaymentId:{type:String,sparse:!0},shippingAddress:{name:{type:String,required:!0},phone:{type:String,required:!0},street:{type:String,required:!0},city:{type:String,required:!0},state:{type:String,required:!0},zipCode:{type:String,required:!0},country:{type:String,required:!0,default:"India"}},billingAddress:{name:{type:String,required:!0},phone:{type:String,required:!0},street:{type:String,required:!0},city:{type:String,required:!0},state:{type:String,required:!0},zipCode:{type:String,required:!0},country:{type:String,required:!0,default:"India"}},shippingMethod:{name:{type:String,required:!0,default:"Standard Shipping"},estimatedDays:{type:Number,required:!0,default:5},trackingNumber:String,trackingUrl:String},notes:{customer:String,admin:String},timeline:[{status:{type:String,required:!0},message:{type:String,required:!0},timestamp:{type:Date,default:Date.now},updatedBy:{type:n().Schema.Types.ObjectId,ref:"User"}}],emailSent:{confirmation:{type:Boolean,default:!1},shipped:{type:Boolean,default:!1},delivered:{type:Boolean,default:!1}},smsSent:{confirmation:{type:Boolean,default:!1},shipped:{type:Boolean,default:!1},delivered:{type:Boolean,default:!1}},refundAmount:{type:Number,min:0},refundReason:String,cancelledAt:Date,cancelledBy:{type:n().Schema.Types.ObjectId,ref:"User"},deliveredAt:Date},{timestamps:!0});a.index({orderNumber:1}),a.index({userId:1}),a.index({status:1}),a.index({paymentStatus:1}),a.index({createdAt:-1}),a.index({razorpayOrderId:1}),a.index({razorpayPaymentId:1}),a.index({"shippingAddress.phone":1}),a.virtual("orderSummary").get(function(){return{orderNumber:this.orderNumber,total:this.total,status:this.status,itemCount:this.items.length,createdAt:this.createdAt}}),a.virtual("customerInfo").get(function(){return{name:this.shippingAddress.name,phone:this.shippingAddress.phone,email:this.userId?.email}}),a.methods.addTimelineEntry=function(e,t,r=null){return this.timeline.push({status:e,message:t,timestamp:new Date,updatedBy:r}),this.save()},a.methods.updateStatus=function(e,t,r=null){return this.status=e,this.addTimelineEntry(e,t,r),"delivered"===e&&(this.deliveredAt=new Date),"cancelled"===e&&(this.cancelledAt=new Date,this.cancelledBy=r),this.save()},a.methods.calculateTotals=function(){return this.subtotal=this.items.reduce((e,t)=>e+t.price*t.quantity,0),this.total=this.subtotal+this.tax+this.shipping-this.discount,this.save()},a.statics.generateOrderNumber=async function(){let e=new Date,t=e.getFullYear().toString().slice(-2),r=(e.getMonth()+1).toString().padStart(2,"0"),i=e.getDate().toString().padStart(2,"0"),n=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1),s=(await this.countDocuments({createdAt:{$gte:n,$lt:a}})+1).toString().padStart(3,"0");return`NV${t}${r}${i}${s}`},a.statics.findByUser=function(e){return this.find({userId:e}).sort({createdAt:-1})},a.statics.findPending=function(){return this.find({status:"pending"}).sort({createdAt:-1})},a.statics.findByStatus=function(e){return this.find({status:e}).sort({createdAt:-1})},a.pre("save",async function(e){this.isNew&&!this.orderNumber&&(this.orderNumber=await this.constructor.generateOrderNumber()),e()}),a.set("toJSON",{virtuals:!0,transform:function(e,t){return delete t.__v,t}});let s=n().models.Order||n().model("Order",a)},87786:(e,t,r)=>{r.d(t,{Z:()=>o});var i=r(11185),n=r.n(i),a=r(6521),s=r.n(a);let d=new(n()).Schema({name:{type:String,required:[!0,"Name is required"],trim:!0,maxlength:[50,"Name cannot be more than 50 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,lowercase:!0,trim:!0,match:[/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,"Please enter a valid email"]},passwordHash:{type:String,required:function(){return!this.googleId&&!this.facebookId}},role:{type:String,enum:["user","admin"],default:"user"},googleId:{type:String,sparse:!0},facebookId:{type:String,sparse:!0},image:{type:String},profileImage:{type:String},phone:{type:String,match:[/^\+?[\d\s-()]+$/,"Please enter a valid phone number"]},addresses:[{type:{type:String,enum:["shipping","billing"],required:!0},street:{type:String,required:!0},city:{type:String,required:!0},state:{type:String,required:!0},zipCode:{type:String,required:!0},country:{type:String,required:!0,default:"India"},isDefault:{type:Boolean,default:!1}}],shippingAddress:{name:String,street:String,city:String,state:String,zipCode:String,country:{type:String,default:"India"},phone:String},emailVerified:{type:Boolean,default:!1},isActive:{type:Boolean,default:!0},cart:[{productId:{type:n().Schema.Types.ObjectId,ref:"Product"},name:String,image:String,price:Number,quantity:{type:Number,default:1},slug:String}],wishlist:[{productId:{type:n().Schema.Types.ObjectId,ref:"Product"},name:String,image:String,price:Number,slug:String,addedAt:{type:Date,default:Date.now}}],lastLogin:{type:Date},resetPasswordToken:{type:String},resetPasswordExpires:{type:Date}},{timestamps:!0});d.index({email:1}),d.index({googleId:1}),d.index({facebookId:1}),d.index({role:1}),d.virtual("password").set(function(e){e&&(this.passwordHash=s().hashSync(e,12))}).get(function(){return this.passwordHash}),d.methods.checkPassword=function(e){return s().compareSync(e,this.passwordHash)},d.methods.getPublicProfile=function(){let e=this.toObject();return delete e.passwordHash,delete e.__v,e},d.statics.findByEmail=function(e){return this.findOne({email:e.toLowerCase()})},d.statics.findAdmins=function(){return this.find({role:"admin"})},d.pre("save",async function(e){if(this.isModified("email")&&await this.constructor.findOne({email:this.email,_id:{$ne:this._id}}))throw Error("Email already exists");e()}),d.set("toJSON",{virtuals:!0,transform:function(e,t){return delete t.passwordHash,delete t.__v,t}});let o=n().models.User||n().model("User",d)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[1638,6206,6521],()=>r(59899));module.exports=i})();