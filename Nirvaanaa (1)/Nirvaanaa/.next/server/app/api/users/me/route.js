"use strict";(()=>{var e={};e.id=3847,e.ids=[3847,2242],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},99699:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>S,originalPathname:()=>b,patchFetch:()=>E,requestAsyncStorage:()=>w,routeModule:()=>h,serverHooks:()=>v,staticGenerationAsyncStorage:()=>y,staticGenerationBailout:()=>x});var i={};t.r(i),t.d(i,{DELETE:()=>g,GET:()=>p,PATCH:()=>f,PUT:()=>m});var a=t(95419),o=t(69108),n=t(99678),s=t(78070),l=t(81355),u=t(82242),d=t(88578),c=t(87786);async function p(e){try{let e=await (0,l.getServerSession)(u.authOptions);if(!e)return s.Z.json({error:"Authentication required"},{status:401});await (0,d.Z)();let r=await c.Z.findById(e.user.id).select("-password");if(!r)return s.Z.json({error:"User not found"},{status:404});return s.Z.json({user:r})}catch(e){return console.error("Error fetching user profile:",e),s.Z.json({error:"Failed to fetch user profile"},{status:500})}}async function m(e){try{let r=await (0,l.getServerSession)(u.authOptions);if(!r)return s.Z.json({error:"Authentication required"},{status:401});await (0,d.Z)();let{name:t,email:i,phone:a,profileImage:o,shippingAddress:n}=await e.json();if(i&&i!==r.user.email&&await c.Z.findOne({email:i}))return s.Z.json({error:"Email already in use"},{status:400});let p={};void 0!==t&&(p.name=t),void 0!==i&&(p.email=i),void 0!==a&&(p.phone=a),void 0!==o&&(p.profileImage=o),void 0!==n&&(p.shippingAddress=n);let m=await c.Z.findByIdAndUpdate(r.user.id,p,{new:!0}).select("-password");return s.Z.json({message:"Profile updated successfully",user:m})}catch(e){return console.error("Error updating user profile:",e),s.Z.json({error:"Failed to update user profile"},{status:500})}}async function f(e){try{let r=await (0,l.getServerSession)(u.authOptions);if(!r)return s.Z.json({error:"Authentication required"},{status:401});await (0,d.Z)();let t=await e.json();if("deleteProfileImage"===t.action){let e=await c.Z.findByIdAndUpdate(r.user.id,{$unset:{profileImage:""}},{new:!0}).select("-password");return s.Z.json({message:"Profile photo removed",user:e})}return s.Z.json({error:"Unsupported action"},{status:400})}catch(e){return console.error("Error in PATCH /api/users/me:",e),s.Z.json({error:"Failed to process request"},{status:500})}}async function g(e){try{let e=await (0,l.getServerSession)(u.authOptions);if(!e)return s.Z.json({error:"Authentication required"},{status:401});await (0,d.Z)();let r={name:"Deleted User",email:`deleted_${e.user.id}@example.com`,phone:void 0,profileImage:void 0,shippingAddress:void 0,isActive:!1};return await c.Z.findByIdAndUpdate(e.user.id,{$set:r},{new:!0}),s.Z.json({success:!0})}catch(e){return console.error("Error deleting account:",e),s.Z.json({error:"Failed to delete account"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/users/me/route",pathname:"/api/users/me",filename:"route",bundlePath:"app/api/users/me/route"},resolvedPagePath:"C:\\Users\\Ananya\\Downloads\\Nirvaanaa_current\\Nirvaanaa (1)\\Nirvaanaa\\app\\api\\users\\me\\route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:w,staticGenerationAsyncStorage:y,serverHooks:v,headerHooks:S,staticGenerationBailout:x}=h,b="/api/users/me/route";function E(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:y})}},82242:(e,r,t)=>{t.d(r,{authOptions:()=>d});var i=t(86485),a=t(10375),o=t(98904),n=t(88578),s=t(87786),l=t(6521),u=t.n(l);let d={providers:[(0,i.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Email and password are required");await (0,n.Z)();let r=await s.Z.findOne({email:e.email});if(!r)throw Error("Invalid email or password");if(!r.passwordHash)throw Error("Please sign in with your social account");if(!await u().compare(e.password,r.passwordHash))throw Error("Invalid email or password");if(!r.isActive)throw Error("Account is deactivated");return{id:r._id.toString(),name:r.name,email:r.email,role:r.role,image:r.image}}}),(0,a.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}),(0,o.Z)({clientId:process.env.FACEBOOK_CLIENT_ID,clientSecret:process.env.FACEBOOK_CLIENT_SECRET})],callbacks:{async signIn({user:e,account:r,profile:t}){if(r?.provider==="google"||r?.provider==="facebook"){await (0,n.Z)();let i=await s.Z.findOne({$or:[{email:e.email},{googleId:"google"===r.provider?t.sub:null},{facebookId:"facebook"===r.provider?t.id:null}]});if(i)return"google"!==r.provider||i.googleId?"facebook"!==r.provider||i.facebookId||(i.facebookId=t.id,i.image=e.image,await i.save()):(i.googleId=t.sub,i.image=e.image,await i.save()),i.isActive;{let i=new s.Z({name:e.name,email:e.email,image:e.image,googleId:"google"===r.provider?t.sub:null,facebookId:"facebook"===r.provider?t.id:null,emailVerified:!0});return await i.save(),!0}}try{await (0,n.Z)();let r=await s.Z.findOne({email:e.email});r&&(r.lastLogin=new Date,await r.save())}catch(e){}return!0},async jwt({token:e,user:r,account:t}){if(r&&(e.role=r.role,e.id=r.id,"admin"===r.role&&(e.maxAge=7200)),t?.provider==="google"||t?.provider==="facebook"){await (0,n.Z)();let r=await s.Z.findOne({email:e.email});r&&(e.role=r.role,e.id=r._id.toString(),"admin"===r.role&&(e.maxAge=7200))}if("admin"===e.role&&e.maxAge){let r=Math.floor(Date.now()/1e3),t=e.iat||r;if(r-t>e.maxAge)return null}return e},async session({session:e,token:r}){if(r&&(e.user.id=r.id,e.user.role=r.role,"admin"===r.role)){await (0,n.Z)();let t=await s.Z.findById(r.id);t&&"admin"===t.role&&t.isActive||(e.user.role="user")}return e}},pages:{signIn:"/auth/signin",error:"/auth/error"},session:{strategy:"jwt",maxAge:2592e3},cookies:{sessionToken:{name:"next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}},callbackUrl:{name:"next-auth.callback-url",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}},csrfToken:{name:"next-auth.csrf-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}},secret:process.env.NEXTAUTH_SECRET,debug:!1}},88578:(e,r,t)=>{t.d(r,{Z:()=>s});var i=t(11185),a=t.n(i);let o=process.env.MONGODB_URI;if(!o)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let n=global.mongoose;n||(n=global.mongoose={conn:null,promise:null});let s=async function(){if(n.conn)return n.conn;n.promise||(n.promise=a().connect(o,{bufferCommands:!1}).then(e=>e));try{n.conn=await n.promise}catch(e){throw n.promise=null,e}return n.conn}},87786:(e,r,t)=>{t.d(r,{Z:()=>l});var i=t(11185),a=t.n(i),o=t(6521),n=t.n(o);let s=new(a()).Schema({name:{type:String,required:[!0,"Name is required"],trim:!0,maxlength:[50,"Name cannot be more than 50 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,lowercase:!0,trim:!0,match:[/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,"Please enter a valid email"]},passwordHash:{type:String,required:function(){return!this.googleId&&!this.facebookId}},role:{type:String,enum:["user","admin"],default:"user"},googleId:{type:String,sparse:!0},facebookId:{type:String,sparse:!0},image:{type:String},profileImage:{type:String},phone:{type:String,match:[/^\+?[\d\s-()]+$/,"Please enter a valid phone number"]},addresses:[{type:{type:String,enum:["shipping","billing"],required:!0},street:{type:String,required:!0},city:{type:String,required:!0},state:{type:String,required:!0},zipCode:{type:String,required:!0},country:{type:String,required:!0,default:"India"},isDefault:{type:Boolean,default:!1}}],shippingAddress:{name:String,street:String,city:String,state:String,zipCode:String,country:{type:String,default:"India"},phone:String},emailVerified:{type:Boolean,default:!1},isActive:{type:Boolean,default:!0},cart:[{productId:{type:a().Schema.Types.ObjectId,ref:"Product"},name:String,image:String,price:Number,quantity:{type:Number,default:1},slug:String}],wishlist:[{productId:{type:a().Schema.Types.ObjectId,ref:"Product"},name:String,image:String,price:Number,slug:String,addedAt:{type:Date,default:Date.now}}],lastLogin:{type:Date},resetPasswordToken:{type:String},resetPasswordExpires:{type:Date}},{timestamps:!0});s.index({email:1}),s.index({googleId:1}),s.index({facebookId:1}),s.index({role:1}),s.virtual("password").set(function(e){e&&(this.passwordHash=n().hashSync(e,12))}).get(function(){return this.passwordHash}),s.methods.checkPassword=function(e){return n().compareSync(e,this.passwordHash)},s.methods.getPublicProfile=function(){let e=this.toObject();return delete e.passwordHash,delete e.__v,e},s.statics.findByEmail=function(e){return this.findOne({email:e.toLowerCase()})},s.statics.findAdmins=function(){return this.find({role:"admin"})},s.pre("save",async function(e){if(this.isModified("email")&&await this.constructor.findOne({email:this.email,_id:{$ne:this._id}}))throw Error("Email already exists");e()}),s.set("toJSON",{virtuals:!0,transform:function(e,r){return delete r.passwordHash,delete r.__v,r}});let l=a().models.User||a().model("User",s)},83191:(e,r)=>{/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */r.parse=function(e,r){if("string"!=typeof e)throw TypeError("argument str must be a string");var t={},a=e.length;if(a<2)return t;var o=r&&r.decode||d,n=0,s=0,c=0;do{if(-1===(s=e.indexOf("=",n)))break;if(-1===(c=e.indexOf(";",n)))c=a;else if(s>c){n=e.lastIndexOf(";",s-1)+1;continue}var p=l(e,n,s),m=u(e,s,p),f=e.slice(p,m);if(!i.call(t,f)){var g=l(e,s+1,c),h=u(e,c,g);34===e.charCodeAt(g)&&34===e.charCodeAt(h-1)&&(g++,h--);var w=e.slice(g,h);t[f]=function(e,r){try{return r(e)}catch(r){return e}}(w,o)}n=c+1}while(n<a);return t},r.serialize=function(e,r,i){var l=i&&i.encode||encodeURIComponent;if("function"!=typeof l)throw TypeError("option encode is invalid");if(!a.test(e))throw TypeError("argument name is invalid");var u=l(r);if(!o.test(u))throw TypeError("argument val is invalid");var d=e+"="+u;if(!i)return d;if(null!=i.maxAge){var c=Math.floor(i.maxAge);if(!isFinite(c))throw TypeError("option maxAge is invalid");d+="; Max-Age="+c}if(i.domain){if(!n.test(i.domain))throw TypeError("option domain is invalid");d+="; Domain="+i.domain}if(i.path){if(!s.test(i.path))throw TypeError("option path is invalid");d+="; Path="+i.path}if(i.expires){var p=i.expires;if("[object Date]"!==t.call(p)||isNaN(p.valueOf()))throw TypeError("option expires is invalid");d+="; Expires="+p.toUTCString()}if(i.httpOnly&&(d+="; HttpOnly"),i.secure&&(d+="; Secure"),i.partitioned&&(d+="; Partitioned"),i.priority)switch("string"==typeof i.priority?i.priority.toLowerCase():i.priority){case"low":d+="; Priority=Low";break;case"medium":d+="; Priority=Medium";break;case"high":d+="; Priority=High";break;default:throw TypeError("option priority is invalid")}if(i.sameSite)switch("string"==typeof i.sameSite?i.sameSite.toLowerCase():i.sameSite){case!0:case"strict":d+="; SameSite=Strict";break;case"lax":d+="; SameSite=Lax";break;case"none":d+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return d};var t=Object.prototype.toString,i=Object.prototype.hasOwnProperty,a=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/,o=/^("?)[\u0021\u0023-\u002B\u002D-\u003A\u003C-\u005B\u005D-\u007E]*\1$/,n=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,s=/^[\u0020-\u003A\u003D-\u007E]*$/;function l(e,r,t){do{var i=e.charCodeAt(r);if(32!==i&&9!==i)return r}while(++r<t);return t}function u(e,r,t){for(;r>t;){var i=e.charCodeAt(--r);if(32!==i&&9!==i)return r+1}return t}function d(e){return -1!==e.indexOf("%")?decodeURIComponent(e):e}},86485:(e,r)=>{r.Z=function(e){return{id:"credentials",name:"Credentials",type:"credentials",credentials:{},authorize:()=>null,options:e}}},98904:(e,r)=>{r.Z=function(e){return{id:"facebook",name:"Facebook",type:"oauth",authorization:"https://www.facebook.com/v11.0/dialog/oauth?scope=email",token:"https://graph.facebook.com/oauth/access_token",userinfo:{url:"https://graph.facebook.com/me",params:{fields:"id,name,email,picture"},async request({tokens:e,client:r,provider:t}){var i;return await r.userinfo(e.access_token,{params:null===(i=t.userinfo)||void 0===i?void 0:i.params})}},profile:e=>({id:e.id,name:e.name,email:e.email,image:e.picture.data.url}),style:{logo:"/facebook.svg",bg:"#006aff",text:"#fff"},options:e}}},10375:(e,r)=>{r.Z=function(e){return{id:"google",name:"Google",type:"oauth",wellKnown:"https://accounts.google.com/.well-known/openid-configuration",authorization:{params:{scope:"openid email profile"}},idToken:!0,checks:["pkce","state"],profile:e=>({id:e.sub,name:e.name,email:e.email,image:e.picture}),style:{logo:"/google.svg",bg:"#fff",text:"#000"},options:e}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[1638,6206,6521,2455,1355],()=>t(99699));module.exports=i})();